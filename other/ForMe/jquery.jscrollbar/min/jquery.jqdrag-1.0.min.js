/**
 * User: daiying.zhang
 * Date: 13-4-16
 * Time: 上午11:47
 * EMail:97532151@qq.com
 * Site: http://sanjh.cn
 */
(function(a){a.fn.jqdrag=function(d){var f={type:"xy",trigger:"self",maxX:+Infinity,maxY:+Infinity,minX:-Infinity,minY:-Infinity},c="JQDrag",e=this.data(c);if(typeof d==="string"){if(e){if(d==="getObject"){return e;}else{if(e[d]){e[d].apply(e,Array.prototype.slice.call(arguments,1));}return this;}}else{throw new Error("This object is ont available!");}}return this.each(function(){var g=new b(a(this),a.extend({},f,d));a(this).data(c,g);});};function b(c,g){this.obj=c;this.settings=g;this.trigger=this.settings.trigger=="self"?this.obj:a(this.settings.trigger);var i=false,e={x:0,y:0},h={x:0,y:0},k={x:0,y:0},l={x:0,y:0},f={x:0,y:0},d=this.settings,j=this.obj;this.trigger.live("mousedown",function(m){if(d.onbeforedrag){if(d.onbeforedrag.call([0])==false){return false;}}e.x=m.pageX;e.y=m.pageY;k.x=parseInt(j.css("left"))||0;k.y=parseInt(j.css("top"))||0;a(document).bind("mousemove.jdrag",function(n){if(!i){i=true;}h.x=n.pageX;h.y=n.pageY;if(d.type=="xy"){l={x:Math.min(Math.max(k.x+h.x-e.x,d.minX),d.maxX),y:Math.min(Math.max(k.y+h.y-e.y,d.minY),d.maxY)};f={x:l.x-k.x,y:l.y-k.y};j.css({left:l.x+"px",top:l.y+"px"});}else{if(d.type=="x"){l={x:Math.min(Math.max(k.x+h.x-e.x,d.minX),d.maxX),y:parseInt(j.css("top"))};f={x:l.x-k.x,y:0};j.css({left:l.x+"px"});}else{if(d.type=="y"){l={x:parseInt(j.css("left")),y:Math.min(Math.max(k.y+h.y-e.y,d.minY),d.maxY)};f={x:0,y:l.y-k.y};j.css({top:l.y+"px"});}}}if(d.ondrag){d.ondrag.call(j[0],f,l);}});return false;});a(document).bind("mouseup.jqdrag",function(m){if(i){if(d.ondragend){d.ondragend.call(j[0],f);}}a(this).unbind("mousemove.jdrag");i=false;});}b.prototype.setOption=function(c,d){this.settings=a.extend(this.settings,c);d&&this.update();return this;};b.prototype.update=function(d){d&&this.setOption(d);var d=this.obj,c=this.settings;d.css({left:Math.max(c.minX,Math.min(parseInt(d.css("left")),c.maxX))+"px",top:Math.max(c.minY,Math.min(parseInt(d.css("top")),c.maxY))+"px"});return this;};})(jQuery);